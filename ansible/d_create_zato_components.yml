---

# This playbook distributes keys and certificates for Zato components,
# creates those components and starts them, and then reconfigures them
# and finally restarts them.
- hosts: zato-components
  become: True
  vars:
    ansible_host: "{{ hostvars[inventory_hostname]['ip'] }}"
    ansible_ssh_private_key_file:
      ./files/vagrant_key/distributed/{{ hostvars[inventory_hostname]['inventory_hostname'] }}_private_key
    servers: "{{ hostvars[inventory_hostname]['groups']['zato-servers'] }}"
    first_server: "{{ hostvars[inventory_hostname]['groups']['zato-servers'][0] }}"

  roles:

    - distribute_zato_certs
    - create_zato_components
    - configure_zato_distributed
