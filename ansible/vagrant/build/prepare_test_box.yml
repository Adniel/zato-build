---

- hosts: localhost
  vars_files:
      - vars/build-box.yml
      - vars/common.yml

  tasks:

    - name: Create Vagrantfiles for a base box
      template: src=./templates/base_box.j2 dest=vm/{{ system }}/Vagrantfile

    - name: Create a "synced" directory
      file: path=./vm/{{ system }}/synced state=directory

    - name: Create a vagrant box
      shell: vagrant up chdir=./vm/{{ system }}

    - name: Copy vagrant user's private key
      shell: cp ./vm/{{ system }}/.vagrant/machines/default/virtualbox/private_key \
              ./files/vagrant_key/

    - name: Set the private_key mode to 0600
      file: path=./files/vagrant_key/private_key mode=0600
