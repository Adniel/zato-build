---

- hosts: localhost

  tasks:

    - name: Prepare a Vagrantfile
      copy: src=./vm/{{ system }}/Vagrantfile.template dest=./vm/{{ system }}/Vagrantfile

    - name: Create a 'synced' directory
      file: path=./vm/{{ system }}/synced state=directory
    
    - name: Create a vagrant box
      shell: vagrant up --no-provision chdir=./vm/{{ system }}

    - name: Run "test" provisioner
      shell: vagrant provision --provision-with=test chdir=./vm/{{ system }}
