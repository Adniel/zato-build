---

- name: Add a new package to repository at repo-box-centos
  copy: src={{ project_root }}/output/{{ system }}/zato-{{ release_version }}-{{ package_version }}.{{ codename }}.{{ architecture }}.rpm
        dest=/var/www/repo/{{ package_version }}/2.0/{{ distribution }}/{{ codename }}/{{ architecture }}

- name: Sign the package
  shell: rpm --sign zato-{{ release_version }}-{{ package_version }}.{{ codename }}.{{ architecture }}.rpm
         chdir=/var/www/repo/{{ package_version }}/2.0/{{ distribution }}/{{ codename }}/{{ architecture }}

- name: Update the repo (effectively add the package)
  shell: createrepo --cache ./cache --update ./
         chdir=/var/www/repo/{{ package_version }}/2.0/{{ distribution }}/{{ codename }}/{{ architecture }}
