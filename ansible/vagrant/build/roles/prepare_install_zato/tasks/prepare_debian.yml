---

- name: Copy repo box's ca certificate
  copy: src={{ repo_host }}/etc/apache2/ssl/{{ repo_host }}.crt
        dest=/usr/local/share/ca-certificates
  become_user: root

- name: Update ca certificates
  shell: update-ca-certificates
  become_user: root

- name: Update cache
  apt: update_cache=yes

# Notice that apt-key has to be performed by root
- name: Add the package signing key
  shell: curl -s https://{{ repo_host }}/repo/zato-deb-test.pub | apt-key add -
  become_user: root

- name: Add Zato test repository
  shell: apt-add-repository \
         https://{{ repo_host }}/repo/{{ package_version }}/2.0/{{ distribution }}
  become_user: root
