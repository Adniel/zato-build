---

    - name: Add repo-boxes to /etc/hosts files on test boxes
      lineinfile: "dest=/etc/hosts
            line='{{ hostvars[repo_hostname].ansible_ssh_host }} {{ hostvars[repo_hostname].inventory_hostname }}'
            state=present"
      become_user: root

    - name: Copy repo box's ca certificate
      shell: cp /vagrant/repo-box-ubuntu.crt /usr/local/share/ca-certificates
      become_user: root

    - name: Update ca certificates
      shell: update-ca-certificates
      become_user: root

    - name: Update cache
      apt: update_cache=yes

    - name: Add the package signing key
      shell: curl -s https://repo-box-ubuntu/repo/zato-deb_pub.gpg | apt-key add -

    - name: Add Zato test repository
      shell: apt-add-repository https://repo-box-ubuntu/repo/{{ package_version }}/2.0/{{ distribution }}
      become_user: root

    - name: Install Zato
      apt: name=zato={{ release_version }}-{{ package_version }}-{{ codename }} update_cache=yes state=present

    - name: Install Zato from package on a Redhat system
      yum: name=/opt/output/zato-{{ release_version }}-{{ package_version }}.el{{ ansible_distribution_major_version }}.{{ ansible_userspace_architecture }}.rpm state=present
      when: ansible_distribution == "CentOS"
