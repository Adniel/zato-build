---

    # Modified https://gist.github.com/rothgar/8793800#file-main-yml
    #- name: Add repo-boxes to /etc/hosts files on test boxes
    #lineinfile: "dest=/etc/hosts regexp='.*{{ item }}$'
    #line='{{ hostvars[item].ansible_default_ipv4.address  }} {{ item }}'
    #state=present
    #when: hostvars[item].ansible_default_ipv4.address is defined
    #with_items: groups['zato-repos']
    #become_user: root"

    - name: Copy repo box's ca certificate
      shell: cp /vagrant/repo.crt /usr/local/share/ca-certificates
      become_user: root

    - name: Update ca certificates
      shell: update-ca-certificates
      become_user: root

    - name: Update cache
      apt: update_cache=yes

    - name: Add the package signing key
      shell: curl -s https://10.2.3.89/repo/zato-deb_pub.gpg | apt-key add -
      become_user: root

    - name: Add Zato test repository
      shell: apt-add-repository https://10.2.3.89/repo/{{ package_version }}/2.0/{{ distribution }}
      become_user: root

    - name: Install Zato
      apt: name=zato update_cache=yes state=present

    - name: Install Zato from package on a Redhat system
      yum: name=/opt/output/zato-{{ release_version }}-{{ package_version }}.el{{ ansible_distribution_major_version }}.{{ ansible_userspace_architecture }}.rpm state=present
      when: ansible_distribution == "CentOS"
