#!/bin/bash
# INIT script to manage start/stop Zato components

ENV=/opt/zato/env

component_all()
{
for catalog in $ENV/*/
 do
    for component in $catalog*/
     do
	x=${component#"$catalog"}
	if [[ $x =~ "server" ]] || [[ $x =~ "web-admin" ]] || [[ $x =~ "load-balancer" ]]; then
	    if [[ $1 == "start" ]]; then echo "Starting ${x%"/"} from $component..."; fi
	    su - zato -c "zato $1 $component"
	fi
     done
 done
}

case "$1" in
  start)
    echo "Starting Zato components..."
    component_all start
    ;;
  restart)
    component_all stop
    component_all start
    ;;
  stop)
    echo "Stopping Zato components..."
    component_all stop
    ;;
  *)
    echo "Usage: $0 {start, stop, restart}"
  ;;
esac
